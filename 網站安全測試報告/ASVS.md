# 使用ASVS

ASVS有兩個主要目標：

* 説明組織開發和維護安全的應用程式。
* 允許安全服務廠商、安全工具供應商和消費者調整他們的要求和產品。

## 應用安全驗證級別

應用程式安全驗證標準（ASVS）定義了三個安全驗證級別，每個級別的深度都在增加。

* ASVS Level 1 適用於低保證級別，可通過滲透測試驗證。
* ASVS Level 2 適用於包含敏感性資料的應用程式（需要保護），是大多數應用程式的推薦級別。
* ASVS Level 3 適用於最關鍵的應用程式：執行高價值交易、包含敏感醫療資料的應用程式，或任何需要最高級別信任的應用程式。

每個ASVS級別都包含一個安全要求的列表。其中的每一項，都可以對應到開發人員必須在軟體中建立的特定安全特性和功能。

![ASVS Level](https://raw.githubusercontent.com/OWASP/ASVS/master/4.0/images/asvs_40_levels.png "ASVS Level")

圖1 - OWASP應用安全驗證標準級別（4.0版）

Level 1 是唯一可以由人類進行滲透測試的級別。 所有其他的等級都需要接觸文檔、原始程式碼、配置以及開發人員。 然而，即使L1允許通過“黑盒”（無文檔和無原始程式碼）測試來驗證，但它並不是有效的保證活動，應儘量避免單獨採用。 惡意攻擊者有大量的時間，但大多數滲透測試在幾周內就會結束。 防禦者需要在合理的時間內，建立安全控制，發現、解決和保護所有的弱點，檢測和應對惡意攻擊者。惡意攻擊者的時間基本上是無限的，只需要一處漏洞，或者一個缺少檢測的弱點就可以成功。 黑盒測試，通常在開發結束時快速執行，或者根本不執行，完全無法應對這種不對稱性。

在過去的 30 多年裡，黑盒測試一次又一次被證明會遺漏關鍵的安全問題，直接導致了越來越多的大規模漏洞。 我們強烈鼓勵使用廣泛的安全保證和驗證，包括用 Level 1 的原始程式碼主導的（混合）滲透測試來取代滲透測試，在整個開發過程中可以充分接觸到開發人員和文檔。 金融監管機構不會容忍“無法接觸帳本、交易樣本或執行控制的人員”的外部財務審計。 行業和政府必須要求軟體工程領域具有相同的透明度標準。

我們強烈鼓勵在開發過程中使用安全工具。 構建管道可以持續使用 DAST 和 SAST 工具，來查找容易發現的、不應該出現的安全問題。

在沒有人工協助的情況下，ASVS中超過半數的驗證項無法被自動化工具和線上掃描完成。 如果需要對每次構建進行全面的自動化測試，則使用自訂單元和集成測試的組合，以及由構建發起的線上掃描。 業務邏輯缺陷和存取控制測試只能使用人工協助。 這些內容應該變成單元和集成測試。

## 如何使用這個標準

使用應用程式安全驗證標準（ASVS）的最佳方法之一，是將其作為一個藍圖，創建一個針對您的應用程式、平臺或組織的安全編碼檢查表。 建議您根據不同的專案場景，針對其中最重要的安全要求，在定制的ASVS中增加關注。

### Level 1 - 第一步，自動化，或全景圖

如果一個應用程式能夠充分防禦 OWASP Top10 或其他類似檢查表中提到的那些容易發現的安全性漏洞，那麼它就達到了ASVS Level 1。

Level 1，是所有應用程式應爭取的最低限度。 作為多個階段工作的第一步，或是當應用程式不存儲或處理敏感性資料，因此不需要L2或L3的更嚴格的控制時，它也是有用的。 Level 1控制可以通過工具自動檢查，也可以在不訪問原始程式碼的情況下簡單地手動檢查。我們認為Level 1是所有應用程式的最低要求。

對應用程式的威脅，往往來自那些使用簡單、省力的技術來識別“簡單漏洞”的攻擊者。 這與堅定的攻擊者形成對比，後者將花費集中的精力專門針對應用程式。 如果您的應用程式處理的資料具有很高的價值，您很少會止步於Level 1。

### Level 2 - 大多數應用程式

如果一個應用程式能夠充分抵禦當今與軟體相關的大多數風險，那麼它就達到了ASVS Level 2（級別或標準）。

Level 2 確保安全控制在應用程式中得到有效的落實。 Level 2 通常適用於處理重要B2B事務（B2B，Business-to-Business）的應用程式， 包括處理醫療保健資訊、實施關鍵業務、實現敏感功能、或處理敏感資產的應用程式，或完整性是保護其業務的關鍵方面的行業，例如打擊遊戲外掛和作弊的遊戲行業。

對 Level 2 應用程式的威脅，通常是熟練的和有動機的攻擊者，他們專注於特定的目標，使用工具和技術有效地發現和利用應用程式中的風險。

### Level 3 - 高價值、高保證或高安全性

ASVS Level 3，是 ASVS 內的最高級別驗證。 這個級別通常保留給需要大量安全驗證的應用，例如軍事、健康、安全和關鍵基礎設施等領域的應用。

對於執行關鍵功能的應用程式，組織可能需要 ASVS Level 3，在這種情況下，故障可能會嚴重影響組織的運作，甚至影響其生存。下面提供了有關 ASVS 3Level 3應用的示例指導。 如果一個應用程式能夠充分防禦高級應用程式的安全性漏洞，並顯示出良好的安全設計原則，那麼它就達到了ASVS Level 3（或高級）。

與其他級別相比，ASVS Level 3 的應用程式需要對架構、編碼和測試進行更深入的分析。 安全的應用程式以有意義的方式模組化的（以促進彈性，可擴展性，以及最重要的安全層），每個由網路連接和/或物理實例分開的模組，負責自己縱深防禦的安全職責，這需要適當的記錄。 職責包括確保機密性（例如加密）、完整性（例如事務、輸入驗證）、可用性（例如優雅地處理負載）、身份驗證（包括系統之間）、授權和審計（日誌記錄）的控制。

## 在實踐中應用ASVS

不同的威脅有不同的動機。某些行業有獨特的資訊和技術資產，以及特定領域的監管要求。

我們強烈建議，各組織根據其業務性質，深入研究其獨特的風險特徵，並根據該風險和業務要求，確定適當的ASVS級別。

## 如何引用ASVS要求

每個需求都有一個識別字，格式為 `<章>.<節>.<要求>` ，每個元素都是一個數位，例如：`1.11.3` 。
- `<chapter>` 值對應於需求出現的章，例如：所有 `1.#.#` 的需求都來自`Architecture`這一章。
- `<section>` 值對應于該章中需求出現的小節，例如：所有 `1.11.#` 需求都在 `Architecture` 章的 `Business Logic Architecture` 部分。
- `<requirement>`值對應該章的具體要求，例如：本標準的4.0.3版本中的 `1.11.3` 是：

> 驗證所有高價值業務邏輯流（包括身份驗證、會話管理和存取控制）都是執行緒安全的，並且可以防止“檢查時間和使用時間不一致”導致的條件競爭問題。

識別字可能會在標準版本之間發生變化，因此在其他文檔、報告或工具最好使用以下格式： `v<version>-<chapter>.<section>.<requirement>` ，其中：“version”是 ASVS 版本標籤。 例如：`v4.0.3-1.11.3` 將被理解為特指版本 4.0.3 中“架構”這一章中“業務邏輯架構”這一節的第 3 項要求。 （可概括為`v<version>-<requirement_identifier>`。）

注意：版本部分前面的 `v` 要小寫。

如果使用不包括 `v<version>` 的識別字，那麼它們應該被認為是指最新的應用安全驗證標準內容。顯然，隨著標準的增長和變化，這將導致問題，這就是為什麼作者或開發者應該將版本包括進去。

ASVS 需求列表，以 CSV、JSON 和其他可能對參考或程式設計有用的格式提供。

# V1 架構、設計和威脅建模

## 控制目標

在許多組織中，安全架構幾乎已成為一門失傳的藝術。 在DevSecOps時代，企業架構師的日子已經過去。應用安全領域必須迎頭趕上，採用敏捷安全原則，同時將領先的安全架構原則重新介紹給軟體從業者。 A架構不是一種實施，而是一種思考問題的方式，它可能有許多不同的答案，而沒有一個單一的“正確”答案。 很多時候，安全被視為不靈活的，要求開發人員以特定方式修復代碼，而開發人員可能知道解決問題的更好方法。 對於架構來說，沒有單一的、簡單的解決方案，嘗試尋找這種方案，是對軟體工程領域的一種損害。

一個Web應用程式的具體實現，很可能在其生命週期中不斷被修改，但整體架構可能很少改變，而是緩慢發展。 安全架構也是一樣的，身份驗證——我們今天需要、明天需要、五年後也需要。 如果我們今天做出合理的決定，選擇和複用符合架構的解決方案，那麼就可以節省大量的精力、時間和金錢。 例如，十年前，多因素認證很少被實施。

如果開發人員已經在單一的“安全標識提供程式模型”上有所投入（例如SAML聯邦認證），身份提供者可以更新以納入新的要求（例如NIST 800-63標準），同時不改變原始應用程式的介面。 如果許多應用程式共用相同的安全架構和元件，那麼它們都將同時從這次升級中受益。 然而，SAML 並不總是最好或最合適的身份驗證解決方案——隨著需求的變化，可能需要替換為其他解決方案。 像這樣的更改要麼很複雜，成本高到需要完全重寫，要麼在沒有安全架構的情況下完全不可能。

在本章中，ASVS涵蓋了任何良好安全架構的主要方面：可用性、保密性、完整性、不可抵賴性和隱私。 這些安全原則中的每一條，都必須適用並內置於所有應用程式中。 “左移”至關重要，從安全編碼Checklists、指導和培訓、編碼和測試、構建、部署、配置和操作開始，到後續的獨立測試，確保所有安全控制存在且功能正常。 這最後一步，曾經是我們作為一個行業所做的一切，但當開發人員每天數十次或數百次地推送代碼時，就已經不夠了。 應用安全專業人員必須跟上敏捷技術的步伐，這意味著要適應開發人員的工具，學習編碼，並與開發人員一起工作，而不是在其他人離開的幾個月後再批評項目。

## V1.1 安全軟體發展生命週期

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.1.1** | 驗證使用安全的軟體發展生命週期，在開發的各個階段解決安全問題。 ([C1](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | |
| **1.1.2** | 驗證在每次設計變更或sprint計畫中使用威脅建模，以識別威脅、計畫對策、促進適當的風險回應，並指導安全測試。 | | ✓ | ✓ | 1053 |
| **1.1.3** | 驗證所有使用者資訊和功能是否包含功能安全約束，例如 “作為一個用戶，我應該能夠查看和編輯我的個人資料。我不應該能夠查看或編輯其他人的資料” | | ✓ | ✓ | 1110 |
| **1.1.4** | 驗證應用程式所有的信任邊界、元件和重要資料流程的文檔，判斷其合理性。 | | ✓ | ✓ | 1059 |
| **1.1.5** | 驗證應用程式的高級架構及遠端連接服務涉及的定義和安全分析。 ([C1](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 1059 |
| **1.1.6** | 驗證集中、簡單（設計）、安全、經過審查、和可重複使用的安全控制措施的實施情況，以避免重複、缺失、無效或不安全的控制措施。 ([C10](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 637 |
| **1.1.7** | 向所有開發人員和測試人員，驗證安全編碼Checklist、安全需求、指南或策略的可用性。 | | ✓ | ✓ | 637 |

## V1.2 認證架構

在設計身份驗證時，如果攻擊者可以通過撥打客服電話，回答常見的問題來重置帳戶，那麼是否具有強大硬體支援的多因素身份驗證（MFA）並不重要。 在證明身份時，所有的認證途徑必須具有相同的強度。

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.2.1** | 驗證應用程式所有的元件、服務和伺服器，是否使用了唯一或特殊的低許可權作業系統帳戶。 ([C3](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 250 |
| **1.2.2** | 驗證應用元件之間（包括 API、中介軟體和資料層）的通信是否經過驗證。元件只具有最低的必要許可權。 ([C3](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 306 |
| **1.2.3** | 驗證應用程式是否使用已知安全的單一認證機制，可以擴展到增強式驗證，並有足夠的日誌記錄和監控，來檢測帳戶濫用或違規行為。 | | ✓ | ✓ | 306 |
| **1.2.4** | 驗證所有的認證途徑和身份管理 API ，都實現了一致的認證安全控制強度， 以便收斂應用程式的風險。 | | ✓ | ✓ | 306 |

## V1.3 會話管理架構

這是未來架構需求的預留位置。

## V1.4 存取控制架構

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.4.1** | 驗證受信任的實施點（如存取控制閘道、伺服器和Serverless函數）是否實施了存取控制。切勿在用戶端實施存取控制。 | | ✓ | ✓ | 602 |
| **1.4.2** | [已刪除，不可操作] | | | | |
| **1.4.3** | [已刪除，與 4.1.3 重複] | | | | |
| **1.4.4** | 驗證應用程式使用單一的、經過嚴格審查的存取控制機制，來訪問受保護的資料和資源。 所有請求都必須通過這個單一機制，以避免複製、粘貼或不安全的替代路徑。 ([C7](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 284 |
| **1.4.5** | 驗證是否使用基於屬性/特徵的存取控制，即代碼應檢查使用者對某一特徵/資料項目的授權，而不僅僅是他們的角色。 許可權仍應依照不同角色進行分配。 ([C7](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 275 |

## V1.5 輸入和輸出架構

在4.0中，我們已經不再把 “伺服器端” 作為一個表示信任邊界的術語。 信任邊界仍然令人擔憂——在不受信任的流覽器或用戶端設備上做決定，很容易被繞過的。 然而，在今天的主流架構部署中，信任的執行點已經發生了巨大的變化。 因此，在 ASVS 中使用 “受信任的服務層” 這一術語時，我們描述的都是受信任的執行點，無論其位置如何，如微服務、Serverless API、伺服器端、具有安全啟動的用戶端設備上的受信任的API、合作夥伴或外部API等等。

這裡的“不受信任的用戶端”一詞，是指呈現展示層的用戶端技術，通常稱為“前端”技術。 這裡的術語“序列化”不僅表示通過網路發送資料（如一個陣列的值或獲取 JSON 結構），還指傳遞可以包含邏輯的複雜物件。

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.5.1** | 驗證輸入和輸出要求，明確規定如何根據類型、內容以及適用的法律、法規和其他政策規定，來操作和處理資料。 | | ✓ | ✓ | 1029 |
| **1.5.2** | 驗證在與不受信任的客戶進行通信時，不使用序列化。 如果無法做到這一點，請確保執行足夠的完整性控制（如果發送敏感性資料，可能還要進行加密），以防止反序列化攻擊，包括對象注入。 | | ✓ | ✓ | 502 |
| **1.5.3** | 驗證輸入驗證是否在可信的服務層上執行。 ([C5](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 602 |
| **1.5.4** | 驗證輸出編碼是否發生在其預期的解譯器附近（或由解譯器進行）。 ([C4](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 116 |

## V1.6 加密架構

應用程式需要設計強大的加密架構，以根據其分類保護資料資產。加密所有東西，是浪費；不加密任何東西，是法律上的疏忽。 在架構或頂層設計、設計衝刺（Design Sprint）或架構高峰期，通常需要取得一種平衡。 一邊設計加密技術，一邊進行開發反覆運算，這樣的安全實施，其成本不可避免地要比一開始就做簡單的構建要高得多。

架構要求是整個代碼庫的內在要求，因此很難進行單元或集成測試。架構需求需要在整個編碼階段的編碼標準中加以考慮，並應在安全架構、代碼審查或複盤會議中加以審查。

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.6.1** | 驗證是否有明確的加密金鑰管理政策，以及加密金鑰的生命週期是否遵循金鑰管理標準，如NIST SP 800-57。 | | ✓ | ✓ | 320 |
| **1.6.2** | 驗證密碼服務的消費者是否通過使用金鑰庫或基於API的替代方案，來保護金鑰材料和其他機密。 | | ✓ | ✓ | 320 |
| **1.6.3** | 驗證所有的金鑰和密碼是否可替換的，並且是重新加密敏感性資料的明確定義流程的一部分。 | | ✓ | ✓ | 320 |
| **1.6.4** | 驗證架構是否將用戶端機密（例如對稱金鑰、密碼或 API 權杖）視為不安全的，並且從不使用它們來保護或訪問敏感性資料。 | | ✓ | ✓ | 320 |

## V1.7 錯誤、日誌和審計架構

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.7.1** | 驗證整個系統是否使用了通用的日誌記錄格式和方法。 ([C9](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 1009 |
| **1.7.2** | 驗證日誌是否安全地傳輸到遠端系統，以便進行分析、檢測、報警和升級。 ([C9](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | |

## V1.8 資料保護和隱私架構

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.8.1** | 驗證所有敏感性資料都已識別並歸入保護級別。 | | ✓ | ✓ | |
| **1.8.2** | 驗證所有保護級別都具有一套相關的保護要求，如加密要求、完整性要求、保留、隱私和其他機密性要求，並在架構中應用這些要求。 | | ✓ | ✓ | |

## V1.9 通信架構

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.9.1** | 驗證應用程式對元件之間的通信進行加密，特別是當這些元件處於不同的容器、系統、網站或雲提供商時。 ([C3](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 319 |
| **1.9.2** | 驗證應用元件是否驗證了通訊連結中每一方的真實性，以防止中間人攻擊。例如，應用程式元件應校驗TLS憑證連結。 | | ✓ | ✓ | 295 |

## V1.10 惡意軟體架構

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.10.1** | 驗證是否使用了原始程式碼控制系統，以及有程式確保簽入時附帶問題或變更單。原始程式碼控制系統應該具有存取控制和可識別的用戶，以追溯任何的更改。 | | ✓ | ✓ | 284 |

## V1.11 業務邏輯架構

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.11.1** | 驗證所有應用元件在其提供的業務或安全功能方面的定義和文檔。 | | ✓ | ✓ | 1059 |
| **1.11.2** | 驗證所有高價值的業務邏輯流，包括認證、會話管理和存取控制，不共用不同步的狀態。 | | ✓ | ✓ | 362 |
| **1.11.3** | 驗證所有高價值的業務邏輯流，包括身份驗證、會話管理和存取控制都是執行緒安全的，並能抵抗檢查時間和使用時間不同步時的條件競爭。 | | | ✓ | 367 |

## V1.12 安全上傳架構

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.12.1** | [已刪除，與 12.4.1 重複] | | | | |
| **1.12.2** | 驗證用戶上傳的檔——如果需要顯示或從應用中下載，是通過二進位流下載，或從無關的域（如雲檔存儲桶）提供。實施合適的內容安全性原則（CSP），以減少來自上傳文件的XSS向量或其他攻擊的風險。 | | ✓ | ✓ | 646 |

## V1.13 API架構

這是未來架構需求的預留位置。

## V1.14 配置架構

| # | 說明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **1.14.1** | 通過明確的安全控制、防火牆規則、API 閘道、反向代理、基於雲的安全性群組或類似機制，驗證不同信任級別的元件的隔離情況。 | | ✓ | ✓ | 923 |
| **1.14.2** | 驗證二進位簽名、可信連接和經過驗證的介面，以將二進位檔案部署到遠端設備。 | | ✓ | ✓ | 494 |
| **1.14.3** | 驗證構建管道是否對過期或不安全的元件發出警告並採取適當的行動。 | | ✓ | ✓ | 1104 |
| **1.14.4** | 驗證構建管道是否包含自動構建和驗證應用安全部署的構建步驟，特別是當應用基礎設施是軟體定義時，例如雲環境構建腳本。 | | ✓ | ✓ | |
| **1.14.5** | 驗證應用程式部署是否在網路級別進行了充分的沙箱化、容器化或隔離，以延遲和阻止攻擊者攻擊其他應用程式，尤其是當攻擊者執行敏感或危險操作時（如反序列化）。 ([C5](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 265 |
| **1.14.6** | 驗證應用程式未使用不受支援、不安全或不推薦的用戶端技術，如NSAPI外掛程式、Flash、Shockwave、ActiveX、Silverlight、NACL或用戶端Java applets。 | | ✓ | ✓ | 477 |

## 參考文獻

有關更多資訊，請參閱：

* [OWASP Threat Modeling Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Threat_Modeling_Cheat_Sheet.html)
* [OWASP Attack Surface Analysis Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Attack_Surface_Analysis_Cheat_Sheet.html)
* [OWASP Threat modeling](https://owasp.org/www-community/Application_Threat_Modeling)
* [OWASP Software Assurance Maturity Model Project](https://owasp.org/www-project-samm/)
* [Microsoft SDL](https://www.microsoft.com/en-us/sdl/)
* [NIST SP 800-57](https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final)
